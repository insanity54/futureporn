{% extends "layouts/base.njk" %}

{% block head %}
  {{ super() }}
  <link rel="stylesheet" href="/@includes/styles/player.scss">
{% endblock %}


{% block content %}
  <div class="container">


  <div class="block">

    {% island 'VideoPlayer.svelte', 'client:load' %}
    {% prop 'videoSrcHash', vod.videoSrcHash %}
    {% prop 'videoHash', vod.videoHash %}
    {% prop 'video720Hash', vod.video720Hash %}
    {% prop 'video360Hash', vod.video360Hash %}
    {% prop 'video240Hash', vod.video240Hash %}
    {% prop 'thiccHash', vod.thiccHash %}
    {% endisland %}
  </div>


  <div class="block">
    <div class="box">
      <p class="heading">IPFS Gateway Selector</p>

      {% island 'GatewaySelector.svelte', 'client:load' %}
      {% prop 'gateways', gateways %}
      {% endisland %}

      {# <div class="select is-primary">
        <select class="gateway-selector">
        {%- for gw in gateways %}
          <option>{{ gw.hostname }} {%- if gw.note %} ({{ gw.note }}){% endif %}</option>
        {% endfor -%}
        </select>
      </div> #}
    </div>
  </div>


  <div class="block">


    <div class="box">

      <h2 class="subtitle mb-0">
        {%- if vod.announceTitle %}
        {{ vod.announceTitle }}
        {% elif vod.title %}
        {{ vod.title }}
        {% endif %}
        
      </h2>
        {% if vod.date %}
          <p class="mt-0 mb-5">{{ vod.date | readableDate }}</p>
        {% endif %}


      <h2 class="heading">
        Download Links
      </h2>

      
      <div class="mb-5">

        <ul class="mb-5">
          {%- if vod.videoSrcHash %}
          <li>
            <span>
              Source: {% island 'IpfsLink.svelte', 'client:load' %}
              {% prop 'gateways', gateways %}
              {% prop 'cid', vod.videoSrcHash %}
              {% endisland %}
            </span>
          </li>
          {% endif %}

          {%- if vod.video720Hash %}
          <li><span>720p: {% island 'IpfsLink.svelte', 'client:load' %}
              {% prop 'cid', vod.video720Hash %}
              {% endisland %}</span></li>
          {% endif %}
          {%- if vod.video480Hash %}
          <li><span>480p: {# {% island 'IpfsLink.svelte', 'client:load' %}
              {% prop 'cid', vod.video480Hash %}
              {% endisland %} #}</span></li>
          {% endif %}
          {%- if vod.video360Hash %}
          <li><span>360p: {# {% island 'IpfsLink.svelte', 'client:load' %}
              {% prop 'cid', vod.video360Hash %}
              {% endisland %} #}</span></li>
          {% endif %}

          {%- if vod.video240Hash %}
            <li>
              <span>240p: {# {% island 'IpfsLink.svelte', 'client:load' %}
              {% prop 'cid', vod.video240Hash %}
              {% endisland %} #}
              </span>
            </li>
          {% endif %}
        </ul>
      </div>


      <h2 class="heading">IPFS Content IDs</h2>

      <ul>
        {%- if vod.videoSrcHash %}
          <li><span>Source: <span class="tag">{{ vod.videoSrcHash | stripQueryString }}</span></span></li>
        {% endif %}
        {%- if vod.video720Hash %}
          <li><span>Source: <span class="tag">{{ vod.video720Hash | stripQueryString }}</span></span></li>
        {% endif %}
        {%- if vod.video480Hash %}
          <li><span>Source: <span class="tag">{{ vod.video480Hash | stripQueryString }}</span></span></li>
        {% endif %}
        {%- if vod.video360Hash %}
          <li><span>Source: <span class="tag">{{ vod.video360Hash | stripQueryString }}</span></span></li>
        {% endif %}
        {%- if vod.video240Hash %}
          <li><span>240p: <span class="tag">{{ vod.video240Hash | stripQueryString }}</span></span></li>
        {% endif %}
      </ul>


      {%- if vod.announceUrl %}
        <div class="mb-5">
          <h2 class="mt-3 heading">Stream Annoucement URL</h2>
          <a href="{{ vod.announceUrl }}">{{ vod.announceUrl }}</a>
        </div>
      {% endif %}

      {# 
        tags coming soon
        {%- if vod.tags %}
        <div class="mb-5">
          <h2 class="mt-3 heading">Tags</h2>
          {%- for tag in vod.tags %}
            <a href="/tags/{{ tag }}">{{ tag }}</a>
          {% endfor -%}
        </div>
      {% endif %} #}


      {%- if vod.note %}
        <div class="mb-3">
          <h2 class="heading">Note</h2>
          <p>{{ vod.note }}</p>
        </div>
      {% endif %}

      <hr>
        
      <div class="level">
        {% if pagination.href.previous %}
          <p>Prev Vod:
          <a 
          href="{{ pagination.href.previous }}">{{ pagination.page.previous.title or pagination.page.previous.announceTitle }}</a>
          </p>
        {% endif %}
        {% if pagination.href.next %}
          <p>Next Vod:
          <a 
          href="{{ pagination.href.next }}">{{ pagination.page.next.title or pagination.page.next.announceTitle }}
          </a>
          </p>
        {% endif %}

      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block footer %}
  {{ super() }}
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script type="module" src="/@includes/js/player.js"></script>
{% endblock %}


{% block end %}
  {{ super() }}
{% endblock %}