{% extends "layouts/base.njk" %}

{% block head %}
  {{ super() }}
  <link rel="stylesheet" href="/@includes/styles/player.scss">
{% endblock %}


{% block content %}
<div class="container">
 
  <div class="block">
    <video id="player" style="--plyr-color-main:#353fff;" controls data-poster="{{ vod.thiccHash | buildIpfsUrl }}">
      {# we originally called it videoHash, but then we switched to videoSrcHash #}
      {%- if vod.videoSrcHash %}
        <source src="{{ vod.videoSrcHash | buildIpfsUrl }}" size="1080" type="video/mp4">
      {% else %}
        <source src="{{ vod.videoHash | buildIpfsUrl }}" size="1080" type="video/mp4">
      {% endif %}

      {%- if vod.video720Hash %}
        <source src="{{ vod.video720Hash | buildIpfsUrl }}" size="720" type="video/mp4">
      {% endif %}

      {%- if vod.video480Hash %}
        <source src="{{ vod.video480Hash | buildIpfsUrl }}" size="480" type="video/mp4">
      {% endif %}

      {%- if vod.video360Hash %}
        <source src="{{ vod.video360Hash | buildIpfsUrl }}" size="360" type="video/mp4">
      {% endif %}

      {%- if vod.video240Hash %}
        <source src="{{ vod.video240Hash | buildIpfsUrl }}" size="240" type="video/mp4">
      {% endif %}
    </video>
  </div>



  <div class="block">

    <div class="box">

      <h2 class="subtitle mb-0">
        {%- if vod.announceTitle %}
        {{ vod.announceTitle }}
        {% elif vod.title %}
        {{ vod.title }}
        {% endif %}
        
      </h2>
        {% if vod.date %}
          <p class="mt-0 mb-5">{{ vod.date | readableDate }}</p>
        {% endif %}

      <h2 class="heading">
        Download Links
        {# {% island 'IpfsGatewaySwitcher.svelte', 'client:load' %}
        {% endisland %} #}
      </h2>

      {# {% island 'IpfsLink.svelte', 'client:load' %}
      {% prop 'cid', vod.videoSrcHash %}
      {% endisland %}


      {% island 'IpfsLink.svelte', 'client:load' %}
      {% prop 'cid', vod.video240Hash %}
      {% endisland %} #}

      <ul class="mb-5">
      {%- if vod.videoSrcHash %}
      <li><span>Source: <a href="{{ vod.videoSrcHash | buildIpfsUrl }}">{{ vod.videoSrcHash | buildIpfsUrl }}</a></span></li>
      {% else %}
      <li><span>Source: <a href="{{ vod.videoHash | buildIpfsUrl }}">{{ vod.videoHash | buildIpfsUrl }}</a></span></li>
      {% endif %}

      {%- if vod.video720Hash %}
      <li><span>720p: <a href="{{ vod.video720Hash | buildIpfsUrl }}">{{ vod.video720Hash | buildIpfsUrl }}</a></span></li>
      {% endif %}
      {%- if vod.video480Hash %}
      <li><span>480p: <a href="{{ vod.video480Hash | buildIpfsUrl }}">{{ vod.video480Hash | buildIpfsUrl }}</a></span></li>
      {% endif %}
      {%- if vod.video360Hash %}
      <li><span>360p: <a href="{{ vod.video360Hash | buildIpfsUrl }}">{{ vod.video360Hash | buildIpfsUrl }}</a></span></li>
      {% endif %}
      {%- if vod.video240Hash %}
      <li><span>240p: <a href="{{ vod.video240Hash | buildIpfsUrl }}">{{ vod.video240Hash | buildIpfsUrl }}</a></span></li>
      {% endif %}
      </ul>


      <h2 class="heading">IPFS Content IDs</h2>

      <ul class="mb-5">
        {%- if vod.videoSrcHash %}
          <li><span>Source: <span class="tag">{{ vod.videoSrcHash | stripQueryString }}</span></span></li>
        {% endif %}
        {%- if vod.video720Hash %}
          <li><span>Source: <span class="tag">{{ vod.video720Hash | stripQueryString }}</span></span></li>
        {% endif %}
        {%- if vod.video480Hash %}
          <li><span>Source: <span class="tag">{{ vod.video480Hash | stripQueryString }}</span></span></li>
        {% endif %}
        {%- if vod.video360Hash %}
          <li><span>Source: <span class="tag">{{ vod.video360Hash | stripQueryString }}</span></span></li>
        {% endif %}
        {%- if vod.video240Hash %}
          <li><span>240p: <span class="tag">{{ vod.video240Hash | stripQueryString }}</span></span></li>
        {% endif %}
      </ul>


      {%- if vod.announceUrl %}
        <div class="mb-5">
          <h2 class="mt-3 heading">Stream Annoucement URL</h2>
          <a href="{{ vod.announceUrl }}">{{ vod.announceUrl }}</a>
        </div>
      {% endif %}

      {# 
        tags coming soon
        {%- if vod.tags %}
        <div class="mb-5">
          <h2 class="mt-3 heading">Tags</h2>
          {%- for tag in vod.tags %}
            <a href="/tags/{{ tag }}">{{ tag }}</a>
          {% endfor -%}
        </div>
      {% endif %} #}


      {%- if vod.note %}
        <div class="mb-3">
          <h2 class="heading">Note</h2>
          <p>{{ vod.note }}</p>
        </div>
      {% endif %}

      <hr>
        
      <div class="level">
        {% if pagination.href.previous %}
          <p>Prev Vod:
          <a 
          href="{{ pagination.href.previous }}">{{ pagination.page.previous.title or pagination.page.previous.announceTitle }}</a>
          </p>
        {% endif %}
        {% if pagination.href.next %}
          <p>Next Vod:
          <a 
          href="{{ pagination.href.next }}">{{ pagination.page.next.title or pagination.page.next.announceTitle }}
          </a>
          </p>
        {% endif %}

      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block footer %}
  {{ super() }}
{% endblock %}

{% block scripts %}
  {{ super() }}
  {# <script type="module" src="/@root/node_modules/plyr/dist/plyr.min.js"></script> #}
  <script type="module" src="/@includes/js/player.js"></script>
{% endblock %}


{% block end %}
  {{ super() }}
{% endblock %}